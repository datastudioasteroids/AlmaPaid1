<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AlmaPaid – Pago de Talleres</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <!-- Header con logo y título -->
  <div class="header">
    <img src="/static/logo.png" alt="AlmaPaid Logo" />
    <h1>AlmaPaid – Pago de Talleres</h1>
  </div>

  <!-- Barra de navegación secundaria -->
  <nav class="admin-nav">
    <span>Bienvenido</span> |
    <a href="/login">Solo para administradores</a>
  </nav>

  <!-- Contenedor principal estilo “tarjeta” -->
  <div class="container">
    <!-- Formulario de búsqueda -->
    <form method="post" action="/create_preference" class="search-form">
      <h2>Buscá tu inscripción</h2>
      <input type="hidden" name="action" value="search" />
      <label for="term">Por nombre, DNI, email o estado:</label>
      <input
        type="text"
        id="term"
        name="term"
        value="{{ term|default('') }}"
        placeholder="Ej. Juan Pérez, 12345678, correo@ejemplo.com"
        required
      />
      <button type="submit">Buscar</button>
    </form>

    <!-- Mensajes de error -->
    {% if error %}
      <p class="error-message">{{ error }}</p>
    {% endif %}
    {% if error_mp %}
      <p class="error-message">
        Error de Mercado Pago:<br>
        <pre>{{ error_mp | tojson(indent=2) }}</pre>
      </p>
    {% endif %}
    {% if multiple %}
      <div class="multiple-results">
        <h3>Se encontraron varias coincidencias:</h3>
        <ul>
          {% for s in multiple %}
            <li>
              <strong>{{ s.name }}</strong>
              {% if s.dni %}(DNI: {{ s.dni }}){% endif %}
              {% if s.email %} – Email: {{ s.email }}{% endif %}
              {% if s.status %} – Estado: {{ s.status }}{% endif %}
            </li>
          {% endfor %}
        </ul>
        <p>Por favor, probá nuevamente con datos más precisos.</p>
      </div>
    {% endif %}

    <!-- Resultado de búsqueda y botón de pago -->
    {% if student %}
      <div class="result-card">
        <h3>Inscripción encontrada:</h3>
        <p><strong>Alumno:</strong> {{ student.name }} {% if student.dni %}(DNI: {{ student.dni }}){% endif %}</p>
        <p><strong>Email:</strong> {{ student.email or '—' }}</p>
        <p><strong>Estado:</strong> {{ student.status }}</p>
        <p><strong>Cursos:</strong> {{ courses | join(', ') }}</p>
        <p><strong>Subtotal:</strong> ${{ subtotal }}</p>
        <p><strong>Recargo:</strong> ${{ surcharge }}</p>
        <p><strong>Total a pagar:</strong> ${{ total }}</p>
        <form method="post" action="/create_preference" class="pay-form">
          <input type="hidden" name="action" value="pay" />
          <input type="hidden" name="student_id" value="{{ student.id }}" />
          <button type="submit">Pagar con Mercado Pago</button>
        </form>
      </div>
    {% endif %}
  </div>
</body>
</html>

